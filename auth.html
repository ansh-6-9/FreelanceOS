<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FreelanceOS - Authentication</title>
    
    <!-- Google OAuth SDK -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333;
        }

        .auth-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 60px 40px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            position: relative;
        }

        .logo {
            font-size: 2.5rem;
            font-weight: 800;
            color: #6366f1;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #6b7280;
            margin-bottom: 40px;
            font-size: 1.1rem;
        }

        .sign-in-button {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #6366f1;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
            z-index: 1000;
        }

        .sign-in-button:hover {
            background: #5855eb;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(99, 102, 241, 0.4);
        }

        .welcome-message {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        .welcome-message .user-name {
            font-weight: 700;
            color: #fbbf24;
        }

        .logout-button {
            background: #ef4444;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            margin-left: 12px;
            transition: background 0.3s ease;
        }

        .logout-button:hover {
            background: #dc2626;
        }

        .auth-content {
            margin-top: 40px;
        }

        .auth-content h2 {
            color: #374151;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .auth-content p {
            color: #6b7280;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .google-signin-container {
            margin-top: 30px;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @media (max-width: 768px) {
            .auth-container {
                padding: 40px 20px;
                margin: 20px;
            }
            
            .sign-in-button,
            .welcome-message {
                top: 10px;
                right: 10px;
                padding: 10px 16px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <!-- Sign In Button (initially visible) -->
    <button id="signInButton" class="sign-in-button" onclick="signIn()">
        Sign In / Sign Up
    </button>

    <!-- Welcome Message (initially hidden) -->
    <div id="welcomeMessage" class="welcome-message" style="display: none;">
        Welcome, <span id="userName" class="user-name"></span>!
        <button class="logout-button" onclick="signOut()">Logout</button>
    </div>

    <div class="auth-container">
        <div class="logo">ðŸš€</div>
        <h1 class="logo">FreelanceOS</h1>
        <p class="subtitle">Your Complete Freelance Workspace</p>
        
        <div id="authContent" class="auth-content">
            <h2>Welcome to FreelanceOS</h2>
            <p>Sign in with your Google account to access your personalized freelance workspace with task management, time tracking, and productivity tools.</p>
            
            <div class="google-signin-container">
                <div id="g_id_onload"
                     data-client_id="540634630212-orivrfkn0cs1pi0e0u3b8rtnaahhakn0.apps.googleusercontent.com"
                     data-context="signin"
                     data-ux_mode="popup"
                     data-callback="handleCredentialResponse"
                     data-auto_prompt="false">
                </div>
                <div class="g_id_signin"
                     data-type="standard"
                     data-shape="rectangular"
                     data-theme="outline"
                     data-text="signin_with"
                     data-size="large"
                     data-logo_alignment="left">
                </div>
            </div>
        </div>
    </div>

    <script>
        // Google OAuth Configuration
        const CLIENT_ID = '540634630212-orivrfkn0cs1pi0e0u3b8rtnaahhakn0.apps.googleusercontent.com';
        
        // Check if user is already signed in
        let isSignedIn = false;
        let userProfile = null;

        // Handle Google Sign-In response
        function handleCredentialResponse(response) {
            // Decode the JWT token to get user information
            const responsePayload = decodeJwtResponse(response.credential);
            
            if (responsePayload) {
                userProfile = {
                    email: responsePayload.email,
                    name: responsePayload.name,
                    firstName: responsePayload.given_name,
                    lastName: responsePayload.family_name,
                    picture: responsePayload.picture
                };
                
                // Store user data in localStorage
                localStorage.setItem('freelanceos_user', JSON.stringify(userProfile));
                localStorage.setItem('freelanceos_signed_in', 'true');
                
                // Update UI
                showWelcomeMessage();
                
                console.log('User signed in successfully:', userProfile);
            }
        }

        // Decode JWT token (client-side only)
        function decodeJwtResponse(token) {
            try {
                const base64Url = token.split('.')[1];
                const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));
                return JSON.parse(jsonPayload);
            } catch (error) {
                console.error('Error decoding JWT:', error);
                return null;
            }
        }

        // Show welcome message
        function showWelcomeMessage() {
            isSignedIn = true;
            
            // Hide sign-in button
            document.getElementById('signInButton').style.display = 'none';
            
            // Show welcome message
            const welcomeMessage = document.getElementById('welcomeMessage');
            const userName = document.getElementById('userName');
            
            // Extract first name from email (fallback to given name)
            let displayName = userProfile.firstName;
            if (!displayName && userProfile.email) {
                displayName = userProfile.email.split('@')[0];
                // Capitalize first letter
                displayName = displayName.charAt(0).toUpperCase() + displayName.slice(1);
            }
            
            userName.textContent = displayName;
            welcomeMessage.style.display = 'block';
            
            // Update main content
            updateMainContent();
        }

        // Update main content after sign-in
        function updateMainContent() {
            const authContent = document.getElementById('authContent');
            authContent.innerHTML = `
                <h2>Welcome back, ${userProfile.firstName || userProfile.email.split('@')[0]}!</h2>
                <p>You're now signed in to FreelanceOS. Your workspace is ready with all your personalized settings and data.</p>
                <div style="margin-top: 30px;">
                    <button onclick="window.location.href='index.html'" style="
                        background: #6366f1;
                        color: white;
                        border: none;
                        padding: 12px 24px;
                        border-radius: 8px;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    ">Go to Workspace</button>
                </div>
            `;
        }

        // Sign out function
        function signOut() {
            // Clear stored data
            localStorage.removeItem('freelanceos_user');
            localStorage.removeItem('freelanceos_signed_in');
            
            // Reset state
            isSignedIn = false;
            userProfile = null;
            
            // Update UI
            document.getElementById('signInButton').style.display = 'block';
            document.getElementById('welcomeMessage').style.display = 'none';
            
            // Reset main content
            document.getElementById('authContent').innerHTML = `
                <h2>Welcome to FreelanceOS</h2>
                <p>Sign in with your Google account to access your personalized freelance workspace with task management, time tracking, and productivity tools.</p>
                
                <div class="google-signin-container">
                    <div id="g_id_onload"
                         data-client_id="540634630212-orivrfkn0cs1pi0e0u3b8rtnaahhakn0.apps.googleusercontent.com"
                         data-context="signin"
                         data-ux_mode="popup"
                         data-callback="handleCredentialResponse"
                         data-auto_prompt="false">
                    </div>
                    <div class="g_id_signin"
                         data-type="standard"
                         data-shape="rectangular"
                         data-theme="outline"
                         data-text="signin_with"
                         data-size="large"
                         data-logo_alignment="left">
                    </div>
                </div>
            `;
            
            // Reinitialize Google Sign-In
            if (window.google && window.google.accounts) {
                window.google.accounts.id.initialize({
                    client_id: "540634630212-orivrfkn0cs1pi0e0u3b8rtnaahhakn0.apps.googleusercontent.com",
                    callback: handleCredentialResponse
                });
                window.google.accounts.id.renderButton(
                    document.querySelector('.g_id_signin'),
                    { theme: 'outline', size: 'large' }
                );
            }
        }

        // Manual sign-in function (fallback)
        function signIn() {
            if (window.google && window.google.accounts) {
                window.google.accounts.id.prompt();
            } else {
                console.log('Google Sign-In SDK not loaded yet');
            }
        }

        // Check authentication status on page load
        document.addEventListener('DOMContentLoaded', function() {
            const savedUser = localStorage.getItem('freelanceos_user');
            const isSignedInSaved = localStorage.getItem('freelanceos_signed_in');
            
            if (savedUser && isSignedInSaved === 'true') {
                userProfile = JSON.parse(savedUser);
                showWelcomeMessage();
            }
        });

        // Handle Google Sign-In SDK load
        window.addEventListener('load', function() {
            if (window.google && window.google.accounts) {
                console.log('Google Sign-In SDK loaded successfully');
            }
        });
    </script>
</body>
</html>
